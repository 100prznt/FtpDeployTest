<!DOCTYPE html>
<html>
<head>
    <title>PoolCalcIo</title>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="Ruemmler, Elias" />
    <meta name="copyright" content="Copyright 2019 - 100prznt.de" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/uikit.min.css" />
    <script src="js/uikit.min.js"></script>
    <script src="js/uikit-icons.min.js"></script>
    <script src="js/jquery-3.3.1.min.js"></script>
</head>
<body>
<div class="uk-section uk-section-muted uk-height-viewport">
    <div class="uk-card uk-card-default uk-width-1-2@m uk-align-center">
        <div class="uk-card-media-top">
            <img src="media/tom-grimbert-tomgrimbert-788775-unsplash.jpg" alt="Photo by Tom Grimbert (@tomgrimbert) on Unsplash">
        </div>
        <div class="uk-card-header" id="header">
            <div class="uk-grid-small uk-flex-middle" uk-grid>
                <div class="uk-width-expand">
                    <h3 class="uk-card-title uk-margin-remove-bottom">PoolCalcIo</h3>
                    <p class="uk-text-meta uk-margin-remove-top" id="version">v1.0.0</p>
                </div>
            </div>
        </div>
        <div uk-alert class="uk-alert-danger uk-invisible" id="error">
            <a class="uk-alert-close" uk-close></a>
            <h3>Fehlerhafte Eingabe</h3>
            <p>Für eine Berechnung werden genau zwei Eingabewerte benötigt!</p>
        </div>
        <div class="uk-card-body">
            <form class="uk-grid-small" uk-grid id="qvd-calc">
                <div class="uk-width-1-1">
                    <div class="uk-legend">Volumenstrom - Rohrinnendurchmesser - Strömungsgeschwindigkeit</div>
                </div>
                <div class="uk-width-2-5">
                    <div class="uk-form-label">Volumenstrom</div>
                </div>
                <div class="uk-width-2-5">
                        <input class="uk-input" type="text" name="q">
                </div>
                <div class="uk-width-1-5">
                    <select class="uk-select" name="unit_q">
                        <option value="1">m³/h</option>
                        <option value="0.001">l/h</option>
                        <option value="0.06">l/min</option>
                    </select>
                </div>

                <div class="uk-width-2-5">
                    <div class="uk-form-label">Rohrinnendurchmesser</div>
                </div>
                <div class="uk-width-2-5">
                    <input class="uk-input" type="text" name="di">
                </div>
                <div class="uk-width-1-5">
                    <select class="uk-select" name="unit_di">
                        <option value="0.001">mm</option>
                        <option value="0.01">cm</option>
                        <option value="1">m</option>
                    </select>
                </div>

                <div class="uk-width-2-5">
                    <div class="uk-form-label">Strömungsgeschwindigkeit</div>
                </div>
                <div class="uk-width-2-5">
                    <input class="uk-input" type="text" name="v">
                </div>
                <div class="uk-width-1-5">
                    <select class="uk-select" name="unit_v">
                        <option value="0.01">cm/s</option>
                        <option value="1">m/s</option>
                    </select>
                </div>
                <div class="uk-width-1-1">
                    <button class="uk-button uk-button-default">Berechnung</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    $.getJSON( "version.json", function( data ) {
        $('#version').text("v" + data["version"])
    });


    var txt_q = $("input[name=q]").first();
    var txt_di = $("input[name=di]").first();
    var txt_v = $("input[name=v]").first();
    var sel_unit_q = $("select[name=unit_q]").first();
    var sel_unit_di = $("select[name=unit_di]").first();
    var sel_unit_v = $("select[name=unit_v]").first();
    var basefac_q = sel_unit_q.children("option").filter(":selected").val();
    var basefac_di = sel_unit_di.children("option").filter(":selected").val();
    var basefac_v = sel_unit_v.children("option").filter(":selected").val();


    $('#qvd-calc').on('submit', function(e){
        e.preventDefault();
        console.log("SUBMIT");

        if (txt_q.val() == "") {
            a = calcA(Number(txt_di.val()) * basefac_di);
            q = a * Number(txt_v.val()) * basefac_v;
            txt_q.val(q / basefac_q);
        } else if (txt_di.val() == "") {
            a = (Number(txt_q.val()) * basefac_q) / (Number(txt_v.val()) * basefac_v);
            di = Math.sqrt(a * 4 / Math.PI);
            txt_di.val(di / basefac_di);
        } else if (txt_v.val() == "") {
            a = calcA(Number(txt_di.val()) * basefac_di);
            v = Number(txt_q.val()) * basefac_q / a;
            txt_v.val(v / basefac_v);
        } else {
            $('#header').after("alert");
        }
    });

    sel_unit_q.change(function() {
        //to base
        q_base = Number(txt_q.val()) * basefac_q;
        //get new basefac
        basefac_q = sel_unit_q.children("option").filter(":selected").val();
        //to specific unit
        txt_q.val(q_base / basefac_q);
    });

    sel_unit_di.change(function() {
        console.log("Start: sel_unit_di");
        printBaseFactors();
        //to base
        di_base = Number(txt_di.val()) * basefac_di;
        //get new basefac
        basefac_di = sel_unit_di.children("option").filter(":selected").val();
        //to specific unit
        txt_di.val(di_base / basefac_di);
        console.log("End: sel_unit_di");
    });

    sel_unit_v.change(function() {
        //to base
        v_base = Number(txt_v.val()) * basefac_v;
        //get new basefac
        basefac_v = sel_unit_v.children("option").filter(":selected").val();
        //to specific unit
        txt_v.val(v_base / basefac_v);
    });

    function printBaseFactors() {
        console.log("Basefactor Q = " + basefac_q);
        console.log("Basefactor d_i = " + basefac_di);
        console.log("Basefactor v = " + basefac_v);
    }

    function calcA(diameter) {
        return Math.pow(diameter, 2) * Math.PI / 4;
    }

    function isNumber(number, min, max) {
        value = Number(number);
        return (!isNaN(value) && value <= max && value >= min);
    }
</script>
</body>
</html>
